plugins:
  # ======================
  # JWT（原設定）
  # ======================
  - name: jwt
    route:
      name: v1-protected
    config:
      claims_to_verify: [exp]
      key_claim_name: kid
      run_on_preflight: false
      header_names:
        - Authorization

  - name: jwt
    route:
      name: api-protected
    config:
      claims_to_verify: [exp]
      key_claim_name: kid
      run_on_preflight: false
      header_names:
        - Authorization

  - name: jwt
    route:
      name: admin-protected
    config:
      claims_to_verify: [exp]
      key_claim_name: kid
      run_on_preflight: false
      header_names:
        - Authorization

  # ======================
  # Rate Limiting（修正後）
  # ======================

  # 1️⃣ 登入 API
  - name: rate-limiting
    route:
      name: auth-google
    config:
      minute: 20
      limit_by: ip
      policy: local
      fault_tolerant: true

  # 2️⃣ 使用者 API（JWT）
  - name: rate-limiting
    route:
      name: v1-protected
    config:
      minute: 300
      limit_by: consumer
      policy: local
      fault_tolerant: true

  # 3️⃣ Post 搜尋
  - name: rate-limiting
    route:
      name: api-posts-search
    config:
      minute: 60
      limit_by: ip
      policy: local
      fault_tolerant: true

  # 4️⃣ Post 受保護 API
  - name: rate-limiting
    route:
      name: api-protected
    config:
      minute: 300
      limit_by: consumer
      policy: local
      fault_tolerant: true

  # ======================
  # CORS（原設定）
  # ======================
  - name: cors
    config:
      origins:
        - https://ntouber.zeabur.app
        - http://localhost:8080
        - http://localhost:5173
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        - PATCH
      headers:
        - Authorization
        - Content-Type
      exposed_headers:
        - Authorization
      credentials: false
      max_age: 3600
